#!/bin/bash
#=========================================================================
# =========================================================================
#
#	setup
#	  Copy run scripts to /userbin.
#
# =========================================================================
#
# @author Jay Wheeler.
# @version 0.0.2
# @copyright © 2018. EarthWalk Software.
# @license Licensed under the GNU General Public License, GPL-3.0-or-later.
# @package ewsdocker/debian-base
# @subpackage setup
#
# =========================================================================
#
#	Copyright © 2018. EarthWalk Software
#	Licensed under the GNU General Public License, GPL-3.0-or-later.
#
#   This file is part of ewsdocker/debian-base.
#
#   ewsdocker/debian-base is free software: you can redistribute 
#   it and/or modify it under the terms of the GNU General Public License 
#   as published by the Free Software Foundation, either version 3 of the 
#   License, or (at your option) any later version.
#
#   ewsdocker/debian-base is distributed in the hope that it will 
#   be useful, but WITHOUT ANY WARRANTY; without even the implied warranty 
#   of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#   GNU General Public License for more details.
#
#   You should have received a copy of the GNU General Public License
#   along with ewsdocker/debian-base.  If not, see 
#   <http://www.gnu.org/licenses/>.
#
# =========================================================================
# =========================================================================

. /usr/local/lib/lms/lmsconCli-0.0.2.bash
. /usr/local/lib/lms/lmsVersion-0.0.1.bash

# =========================================================================
#
#    Display the version stack
#
# =========================================================================

lmsVersion

# =========================================================================
#
#    copy /usr/local subdirectories to the directory specified in LMS_BASE
#		environment variable in the cli parameters to start setup
#
# =========================================================================
function rmDestFile 
{
    [[ -f "${1}" ]] && rm "${1}"
}

mkdir -p /usrlocal/share/lms
mkdir -p /usrlocal/lib/lms
mkdir -p /usrlocal/bin

cp -r /usr/local/share/*   /usrlocal/share
cp -r /usr/local/lib/lms/* /usrlocal/lib/lms
cp    /usr/local/bin/*     /usrlocal/bin

cd /usr/local/bin

for fname in *
do
    [[ -f "${fname}" ]] && rmDestFile "/usrlocal/bin/${fname}"
    cp "${fname}" "/usrlocal/bin/${fname}"
done

chmod +x /usrlocal/bin/*

echo "LMS_BASE=${LMS_BASE}" > /root/lms-base.conf
chmod 755 /root/lms-base.conf

echo
echo "Internal setup completed."
echo

exit 0
